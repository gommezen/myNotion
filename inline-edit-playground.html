<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MyNotion — InlineEditBar Playground</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&family=Instrument+Serif:ital@0;1&display=swap');

*{box-sizing:border-box;margin:0;padding:0}
:root{
  --panel:#12151a;
  --surface:#0d0f13;
  --border:#1e2228;
  --gold:#d4a84b;
  --gold-dim:rgba(212,168,75,.35);
  --text:#b8bcc4;
  --text-dim:#6a6e78;
  --mono:'IBM Plex Mono',Consolas,monospace;
  --serif:'Instrument Serif',Georgia,serif;
}

html,body{height:100%;overflow:hidden;background:var(--surface);color:var(--text);font-family:var(--mono);font-size:12px}

/* ═══ LAYOUT ═══ */
.app{display:grid;grid-template-columns:360px 1fr;grid-template-rows:1fr auto;height:100vh}
.controls{grid-row:1/3;background:var(--panel);border-right:1px solid var(--border);overflow-y:auto;overflow-x:hidden}
.preview-area{grid-column:2;overflow-y:auto;position:relative}
.output-area{grid-column:2;border-top:1px solid var(--border);background:var(--panel)}

/* ═══ CONTROLS PANEL ═══ */
.controls{padding:0}
.controls-header{padding:20px 18px 14px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--panel);z-index:10}
.controls-header h1{font-family:var(--serif);font-size:22px;color:var(--gold);font-weight:400;letter-spacing:-.3px;line-height:1.1}
.controls-header h1 em{font-style:italic;opacity:.7}
.controls-header .sub{font-size:10px;color:var(--text-dim);margin-top:4px;letter-spacing:.4px;text-transform:uppercase}
.controls-inner{padding:10px 18px 24px}

/* Section headers */
.section{margin-top:16px}
.section:first-child{margin-top:4px}
.section-head{display:flex;align-items:center;gap:8px;padding:6px 0;cursor:pointer;user-select:none}
.section-head::before{content:'';display:block;width:6px;height:6px;background:var(--gold);clip-path:polygon(100% 50%,0 0,0 100%);transition:transform .2s;flex-shrink:0}
.section-head.open::before{transform:rotate(90deg)}
.section-head span{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--text-dim);font-weight:600}
.section-body{display:none;padding:4px 0 2px 14px}
.section-body.open{display:block}

/* Control rows */
.ctrl{display:flex;align-items:center;gap:8px;min-height:26px;margin:2px 0}
.ctrl label{flex:0 0 105px;font-size:11px;color:var(--text-dim);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ctrl input[type=color]{width:28px;height:22px;border:1px solid var(--border);border-radius:3px;background:transparent;cursor:pointer;padding:0;flex-shrink:0}
.ctrl input[type=color]::-webkit-color-swatch-wrapper{padding:1px}
.ctrl input[type=color]::-webkit-color-swatch{border:none;border-radius:2px}
.ctrl input[type=range]{flex:1;accent-color:var(--gold);height:3px;cursor:pointer}
.ctrl .val{min-width:40px;text-align:right;color:var(--gold);font-size:10px;font-weight:500;user-select:all}
.ctrl select{flex:1;background:var(--surface);color:var(--text);border:1px solid var(--border);border-radius:3px;padding:3px 6px;font-size:11px;font-family:var(--mono);cursor:pointer}
.ctrl select:focus{border-color:var(--gold);outline:none}
.ctrl input[type=text]{flex:1;background:var(--surface);color:var(--text);border:1px solid var(--border);border-radius:3px;padding:3px 8px;font-size:11px;font-family:var(--mono)}
.ctrl input[type=text]:focus{border-color:var(--gold);outline:none}

/* Toggle */
.toggle-row{display:flex;align-items:center;gap:8px;min-height:26px;margin:2px 0}
.toggle-row label:first-child{flex:0 0 105px;font-size:11px;color:var(--text-dim)}
.tgl{position:relative;width:32px;height:18px;cursor:pointer;flex-shrink:0}
.tgl input{display:none}
.tgl .track{position:absolute;inset:0;background:var(--border);border-radius:9px;transition:.2s}
.tgl .track::before{content:'';position:absolute;width:14px;height:14px;left:2px;top:2px;background:#555;border-radius:50%;transition:.2s}
.tgl input:checked+.track{background:var(--gold)}
.tgl input:checked+.track::before{transform:translateX(14px);background:#111}
.tgl-val{font-size:10px;color:var(--gold);font-weight:500}

/* Presets */
.presets{display:flex;flex-wrap:wrap;gap:4px;margin:6px 0 2px}
.presets button{padding:4px 8px;border:1px solid var(--border);border-radius:3px;background:var(--surface);color:var(--text-dim);font-size:10px;font-family:var(--mono);cursor:pointer;transition:all .15s;letter-spacing:.3px}
.presets button:hover{border-color:var(--gold);color:var(--gold)}
.presets button.active{background:var(--gold);color:#111;border-color:var(--gold);font-weight:600}

/* Action buttons */
.action-row{display:flex;flex-wrap:wrap;gap:4px;margin:4px 0}
.action-btn{padding:5px 10px;border:1px solid var(--border);border-radius:3px;background:var(--surface);color:var(--text);font-size:10px;font-family:var(--mono);cursor:pointer;transition:all .15s;letter-spacing:.3px}
.action-btn:hover{border-color:var(--gold);color:var(--gold)}
.action-btn:active{background:var(--gold);color:#111}

/* ═══ PREVIEW ═══ */
.preview-area{display:flex;align-items:flex-start;justify-content:center;background:var(--surface);padding:24px}
.editor-sim{width:100%;max-width:880px;background:#1a2a2a;border-radius:4px;border:1px solid #243636;overflow:hidden;position:relative}
.editor-sim .tab-bar{display:flex;background:#0f1a1a;border-bottom:1px solid #243636;padding:0}
.editor-sim .tab{padding:7px 16px;font-size:11px;color:rgba(200,224,206,.4);border-right:1px solid #1a2a2a}
.editor-sim .tab.active{color:#c8e0ce;background:#1a2a2a;border-top:2px solid #d4a84b;margin-top:-1px}
.editor-sim .code-area{position:relative;padding:0;font-size:13px;line-height:1.65;min-height:420px}
.code-lines{display:flex;flex-direction:column}
.code-line{display:flex;padding:0 16px 0 0}
.code-line .ln{width:48px;text-align:right;padding-right:16px;color:#4a6a5a;font-size:12px;user-select:none;flex-shrink:0;background:#0f1414}
.code-line .lc{color:rgba(200,224,206,.25);white-space:pre;font-family:var(--mono);font-size:13px}
.code-line .lc .kw{color:rgba(212,168,75,.3)}
.code-line .lc .fn{color:rgba(127,191,181,.3)}
.code-line .lc .st{color:rgba(168,216,208,.3)}
.code-line .lc .cm{color:rgba(74,128,128,.3)}
.code-line .lc .nr{color:rgba(232,197,71,.3)}
.code-line.hl{background:rgba(212,168,75,.04)}

/* Widget states container */
.states-col{position:absolute;top:0;left:0;right:0;display:flex;flex-direction:column;gap:0}
.state-block{position:relative}
.state-tag{position:absolute;right:8px;top:4px;font-size:9px;color:var(--gold);opacity:.5;letter-spacing:.5px;text-transform:uppercase;z-index:5;pointer-events:none}

/* The inline edit widget preview */
.ie-widget{margin:2px 48px 2px 48px;position:relative;transition:all .3s ease}
.ie-widget .ie-inner{display:flex;flex-direction:column}
.ie-widget .ie-label-row{display:flex;align-items:center;gap:6px}
.ie-widget .ie-icon{flex-shrink:0;line-height:1}
.ie-widget .ie-label{font-weight:bold}
.ie-widget .ie-input{outline:none;width:100%;transition:border-color .2s}
.ie-widget .ie-input::placeholder{transition:color .2s}
.ie-widget .ie-status{transition:color .2s}
.ie-widget .ie-input::selection{background:var(--sel-bg,#2d4242);color:var(--sel-fg,#c8e0ce)}

/* Generating animation */
@keyframes iePulse{0%,100%{opacity:.4}50%{opacity:1}}
.ie-widget.generating .ie-status{animation:iePulse 1.2s ease-in-out infinite}

/* Show animation */
@keyframes ieSlideIn{from{opacity:0;transform:translateY(-8px) scaleY(.95)}to{opacity:1;transform:translateY(0) scaleY(1)}}
.ie-widget.anim-show{animation:ieSlideIn .3s cubic-bezier(.16,1,.3,1)}

/* ═══ OUTPUT ═══ */
.output-area{padding:12px 16px;display:flex;flex-direction:column;gap:6px;max-height:260px;min-height:100px}
.output-head{display:flex;align-items:center;justify-content:space-between}
.output-head h3{font-size:10px;color:var(--text-dim);text-transform:uppercase;letter-spacing:.8px;font-weight:600}
.copy-btn{padding:4px 12px;border:1px solid var(--border);border-radius:3px;background:var(--surface);color:var(--text-dim);font-size:10px;font-family:var(--mono);cursor:pointer;transition:all .15s}
.copy-btn:hover{border-color:var(--gold);color:var(--gold)}
.copy-btn.copied{background:var(--gold);color:#111;border-color:var(--gold)}
.output-code{flex:1;font-family:var(--mono);font-size:11px;color:#9aa0a6;line-height:1.55;white-space:pre-wrap;overflow-y:auto;padding:10px 12px;background:var(--surface);border-radius:4px;border:1px solid var(--border);tab-size:4}
.output-code .py-str{color:#a8d8d0}
.output-code .py-kw{color:#d4a84b}
.output-code .py-cm{color:#4a6a6a}

/* Scrollbar */
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:#2a2f3a;border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:#3a3f4a}
</style>
</head>
<body>
<div class="app">

<!-- ═══════════ CONTROLS ═══════════ -->
<div class="controls">
  <div class="controls-header">
    <h1>InlineEditBar <em>Playground</em></h1>
    <div class="sub">MyNotion — Ctrl+K Widget Designer</div>
  </div>
  <div class="controls-inner">

    <!-- Presets -->
    <div class="section">
      <div class="section-head open" onclick="toggleSection(this)"><span>Presets</span></div>
      <div class="section-body open">
        <div class="presets" id="presets"></div>
      </div>
    </div>

    <!-- Dimensions -->
    <div class="section">
      <div class="section-head open" onclick="toggleSection(this)"><span>Dimensions</span></div>
      <div class="section-body open">
        <div class="ctrl"><label>Width</label><input type="range" data-key="width" min="300" max="900" step="10"><span class="val" data-val="width"></span></div>
        <div class="ctrl"><label>Input Height</label><input type="range" data-key="inputHeight" min="28" max="60" step="1"><span class="val" data-val="inputHeight"></span></div>
        <div class="ctrl"><label>Padding</label><input type="range" data-key="padding" min="4" max="24" step="1"><span class="val" data-val="padding"></span></div>
        <div class="ctrl"><label>Spacing</label><input type="range" data-key="spacing" min="2" max="16" step="1"><span class="val" data-val="spacing"></span></div>
        <div class="ctrl"><label>Border Radius</label><input type="range" data-key="borderRadius" min="0" max="20" step="1"><span class="val" data-val="borderRadius"></span></div>
        <div class="ctrl"><label>Border Width</label><input type="range" data-key="borderWidth" min="0" max="6" step="1"><span class="val" data-val="borderWidth"></span></div>
      </div>
    </div>

    <!-- Colors -->
    <div class="section">
      <div class="section-head open" onclick="toggleSection(this)"><span>Colors</span></div>
      <div class="section-body open">
        <div class="ctrl"><label>Widget BG</label><input type="color" data-key="widgetBg"><span class="val" data-val="widgetBg"></span></div>
        <div class="ctrl"><label>Widget Border</label><input type="color" data-key="widgetBorder"><span class="val" data-val="widgetBorder"></span></div>
        <div class="ctrl"><label>Input BG</label><input type="color" data-key="inputBg"><span class="val" data-val="inputBg"></span></div>
        <div class="ctrl"><label>Input Text</label><input type="color" data-key="inputText"><span class="val" data-val="inputText"></span></div>
        <div class="ctrl"><label>Input Border</label><input type="color" data-key="inputBorder"><span class="val" data-val="inputBorder"></span></div>
        <div class="ctrl"><label>Focus Border</label><input type="color" data-key="focusBorder"><span class="val" data-val="focusBorder"></span></div>
        <div class="ctrl"><label>Label Color</label><input type="color" data-key="labelColor"><span class="val" data-val="labelColor"></span></div>
        <div class="ctrl"><label>Status Color</label><input type="color" data-key="statusColor"><span class="val" data-val="statusColor"></span></div>
        <div class="ctrl"><label>Placeholder</label><input type="color" data-key="placeholderColor"><span class="val" data-val="placeholderColor"></span></div>
        <div class="ctrl"><label>Accent</label><input type="color" data-key="accent"><span class="val" data-val="accent"></span></div>
        <div class="ctrl"><label>Error Color</label><input type="color" data-key="errorColor"><span class="val" data-val="errorColor"></span></div>
        <div class="ctrl"><label>Selection BG</label><input type="color" data-key="selBg"><span class="val" data-val="selBg"></span></div>
        <div class="ctrl"><label>Selection Text</label><input type="color" data-key="selText"><span class="val" data-val="selText"></span></div>
      </div>
    </div>

    <!-- Typography -->
    <div class="section">
      <div class="section-head" onclick="toggleSection(this)"><span>Typography</span></div>
      <div class="section-body">
        <div class="ctrl"><label>Label Size</label><input type="range" data-key="labelSize" min="8" max="24" step="1"><span class="val" data-val="labelSize"></span></div>
        <div class="ctrl"><label>Input Size</label><input type="range" data-key="inputSize" min="10" max="24" step="1"><span class="val" data-val="inputSize"></span></div>
        <div class="ctrl"><label>Status Size</label><input type="range" data-key="statusSize" min="8" max="18" step="1"><span class="val" data-val="statusSize"></span></div>
        <div class="ctrl"><label>Font Family</label><select data-key="fontFamily">
          <option value="system-ui, sans-serif">System UI</option>
          <option value="Consolas, monospace">Consolas</option>
          <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
          <option value="'Fira Code', monospace">Fira Code</option>
          <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
          <option value="monospace">Monospace</option>
          <option value="'Courier New', monospace">Courier New</option>
        </select></div>
        <div class="ctrl"><label>Label Weight</label><select data-key="labelWeight">
          <option value="normal">Normal</option>
          <option value="500">500</option>
          <option value="600">600</option>
          <option value="bold">Bold</option>
          <option value="800">800</option>
        </select></div>
      </div>
    </div>

    <!-- Effects -->
    <div class="section">
      <div class="section-head" onclick="toggleSection(this)"><span>Effects</span></div>
      <div class="section-body">
        <div class="toggle-row"><label>Box Shadow</label><label class="tgl"><input type="checkbox" data-key="shadowOn"><span class="track"></span></label><span class="tgl-val" data-tval="shadowOn"></span></div>
        <div class="ctrl"><label>Shadow Color</label><input type="color" data-key="shadowColor"><span class="val" data-val="shadowColor"></span></div>
        <div class="ctrl"><label>Shadow Blur</label><input type="range" data-key="shadowBlur" min="0" max="40" step="1"><span class="val" data-val="shadowBlur"></span></div>
        <div class="ctrl"><label>Shadow Spread</label><input type="range" data-key="shadowSpread" min="-10" max="20" step="1"><span class="val" data-val="shadowSpread"></span></div>
        <div class="toggle-row"><label>Focus Glow</label><label class="tgl"><input type="checkbox" data-key="glowOn"><span class="track"></span></label><span class="tgl-val" data-tval="glowOn"></span></div>
        <div class="ctrl"><label>Glow Color</label><input type="color" data-key="glowColor"><span class="val" data-val="glowColor"></span></div>
        <div class="ctrl"><label>Glow Intensity</label><input type="range" data-key="glowIntensity" min="2" max="30" step="1"><span class="val" data-val="glowIntensity"></span></div>
        <div class="ctrl"><label>Border Style</label><select data-key="borderStyle">
          <option value="solid">Solid</option>
          <option value="double">Double</option>
          <option value="groove">Groove</option>
          <option value="ridge">Ridge</option>
          <option value="inset">Inset</option>
          <option value="outset">Outset</option>
        </select></div>
        <div class="toggle-row"><label>BG Gradient</label><label class="tgl"><input type="checkbox" data-key="gradientOn"><span class="track"></span></label><span class="tgl-val" data-tval="gradientOn"></span></div>
        <div class="ctrl"><label>Gradient End</label><input type="color" data-key="gradientEnd"><span class="val" data-val="gradientEnd"></span></div>
        <div class="ctrl"><label>Gradient Angle</label><input type="range" data-key="gradientAngle" min="0" max="360" step="5"><span class="val" data-val="gradientAngle"></span></div>
        <div class="toggle-row"><label>Backdrop Blur</label><label class="tgl"><input type="checkbox" data-key="blurOn"><span class="track"></span></label><span class="tgl-val" data-tval="blurOn"></span></div>
        <div class="ctrl"><label>Blur Amount</label><input type="range" data-key="blurAmount" min="2" max="30" step="1"><span class="val" data-val="blurAmount"></span></div>

        <!-- Bevel -->
        <div class="toggle-row"><label>3D Bevel</label><label class="tgl"><input type="checkbox" data-key="bevelOn"><span class="track"></span></label><span class="tgl-val" data-tval="bevelOn"></span></div>
        <div class="ctrl"><label>Bevel Light</label><input type="color" data-key="bevelLight"><span class="val" data-val="bevelLight"></span></div>
        <div class="ctrl"><label>Bevel Dark</label><input type="color" data-key="bevelDark"><span class="val" data-val="bevelDark"></span></div>
      </div>
    </div>

    <!-- Icon / Logo -->
    <div class="section">
      <div class="section-head" onclick="toggleSection(this)"><span>Icon / Logo</span></div>
      <div class="section-body">
        <div class="toggle-row"><label>Show Icon</label><label class="tgl"><input type="checkbox" data-key="iconOn"><span class="track"></span></label><span class="tgl-val" data-tval="iconOn"></span></div>
        <div class="ctrl"><label>Icon Char</label><input type="text" data-key="iconChar" maxlength="4" style="width:50px;flex:0 0 50px"><span class="val" style="flex:1"></span></div>
        <div class="ctrl"><label>Icon Color</label><input type="color" data-key="iconColor"><span class="val" data-val="iconColor"></span></div>
        <div class="ctrl"><label>Icon Size</label><input type="range" data-key="iconSize" min="10" max="32" step="1"><span class="val" data-val="iconSize"></span></div>
      </div>
    </div>

    <!-- Animation -->
    <div class="section">
      <div class="section-head" onclick="toggleSection(this)"><span>Animation Preview</span></div>
      <div class="section-body">
        <div class="action-row">
          <button class="action-btn" onclick="animShow()">Show</button>
          <button class="action-btn" onclick="animGenerating()">Generating</button>
          <button class="action-btn" onclick="animDone()">Done</button>
          <button class="action-btn" onclick="animError()">Error</button>
          <button class="action-btn" onclick="animReset()">Reset</button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ═══════════ PREVIEW ═══════════ -->
<div class="preview-area">
  <div class="editor-sim">
    <div class="tab-bar">
      <div class="tab active">main.py</div>
      <div class="tab">utils.py</div>
      <div class="tab">config.json</div>
    </div>
    <div class="code-area" id="codeArea"></div>
  </div>
</div>

<!-- ═══════════ OUTPUT ═══════════ -->
<div class="output-area">
  <div class="output-head">
    <h3>Generated PyQt6 QSS</h3>
    <button class="copy-btn" onclick="copyQSS(this)">Copy QSS</button>
  </div>
  <div class="output-code" id="outputCode"></div>
</div>

</div>

<script>
// ═══════════════════════════════════════════════
//  STATE
// ═══════════════════════════════════════════════

const PRESETS = {
  "Current": {
    width:700, inputHeight:38, padding:12, spacing:8, borderRadius:8, borderWidth:2,
    widgetBg:"#0f1a1a", widgetBorder:"#d4a84b", inputBg:"#1a2a2a", inputText:"#c8e0ce",
    inputBorder:"#3a5252", focusBorder:"#d4a84b", labelColor:"#d4a84b", statusColor:"#4a8080",
    placeholderColor:"#4a6a5a", accent:"#d4a84b", errorColor:"#c45c5c",
    selBg:"#2d4242", selText:"#c8e0ce",
    labelSize:12, inputSize:13, statusSize:11, fontFamily:"system-ui, sans-serif", labelWeight:"bold",
    shadowOn:false, shadowColor:"#000000", shadowBlur:12, shadowSpread:0,
    glowOn:false, glowColor:"#d4a84b", glowIntensity:8,
    borderStyle:"solid",
    gradientOn:false, gradientEnd:"#1a2a2a", gradientAngle:180,
    blurOn:false, blurAmount:10,
    bevelOn:false, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:false, iconChar:"\u25c6", iconColor:"#d4a84b", iconSize:14
  },
  "Win95 Bevel": {
    width:680, inputHeight:34, padding:10, spacing:6, borderRadius:0, borderWidth:2,
    widgetBg:"#0f1a1a", widgetBorder:"#3a5252", inputBg:"#1a2a2a", inputText:"#c8e0ce",
    inputBorder:"#0a1414", focusBorder:"#0a1414", labelColor:"#d4a84b", statusColor:"#4a8080",
    placeholderColor:"#4a6a5a", accent:"#d4a84b", errorColor:"#c45c5c",
    selBg:"#2d4242", selText:"#c8e0ce",
    labelSize:12, inputSize:13, statusSize:10, fontFamily:"system-ui, sans-serif", labelWeight:"bold",
    shadowOn:false, shadowColor:"#000000", shadowBlur:0, shadowSpread:0,
    glowOn:false, glowColor:"#d4a84b", glowIntensity:8,
    borderStyle:"solid",
    gradientOn:false, gradientEnd:"#1a2a2a", gradientAngle:180,
    blurOn:false, blurAmount:10,
    bevelOn:true, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:false, iconChar:"\u25c6", iconColor:"#d4a84b", iconSize:14
  },
  "Neon Cyber": {
    width:720, inputHeight:42, padding:14, spacing:10, borderRadius:2, borderWidth:1,
    widgetBg:"#0a0a14", widgetBorder:"#00f0ff", inputBg:"#0d0d1a", inputText:"#e0f0ff",
    inputBorder:"#1a1a3a", focusBorder:"#00f0ff", labelColor:"#00f0ff", statusColor:"#0088aa",
    placeholderColor:"#334466", accent:"#00f0ff", errorColor:"#ff2266",
    selBg:"#003344", selText:"#e0f0ff",
    labelSize:11, inputSize:14, statusSize:10, fontFamily:"'IBM Plex Mono', monospace", labelWeight:"600",
    shadowOn:true, shadowColor:"#00f0ff", shadowBlur:20, shadowSpread:-2,
    glowOn:true, glowColor:"#00f0ff", glowIntensity:12,
    borderStyle:"solid",
    gradientOn:true, gradientEnd:"#0a0818", gradientAngle:135,
    blurOn:false, blurAmount:10,
    bevelOn:false, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:true, iconChar:"\u26a1", iconColor:"#00f0ff", iconSize:16
  },
  "Glassmorphism": {
    width:700, inputHeight:40, padding:16, spacing:10, borderRadius:14, borderWidth:1,
    widgetBg:"#1a2a2a", widgetBorder:"#4a6a6a", inputBg:"#1a2a2a", inputText:"#d0e8d8",
    inputBorder:"#3a5a5a", focusBorder:"#7fbfb5", labelColor:"#a8d8d0", statusColor:"#4a8080",
    placeholderColor:"#3a6060", accent:"#7fbfb5", errorColor:"#c45c5c",
    selBg:"#2d5252", selText:"#e0f0e8",
    labelSize:12, inputSize:13, statusSize:11, fontFamily:"system-ui, sans-serif", labelWeight:"500",
    shadowOn:true, shadowColor:"#000000", shadowBlur:30, shadowSpread:-4,
    glowOn:false, glowColor:"#7fbfb5", glowIntensity:8,
    borderStyle:"solid",
    gradientOn:false, gradientEnd:"#1a3030", gradientAngle:160,
    blurOn:true, blurAmount:16,
    bevelOn:false, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:true, iconChar:"\u25c7", iconColor:"#7fbfb5", iconSize:14
  },
  "Metropolis Gold": {
    width:740, inputHeight:44, padding:16, spacing:10, borderRadius:0, borderWidth:2,
    widgetBg:"#0f1a1a", widgetBorder:"#d4a84b", inputBg:"#0a1212", inputText:"#e8e4d9",
    inputBorder:"#8a6a2a", focusBorder:"#d4a84b", labelColor:"#d4a84b", statusColor:"#a67c35",
    placeholderColor:"#5a4a2a", accent:"#d4a84b", errorColor:"#c45c5c",
    selBg:"#3a2a10", selText:"#e8e4d9",
    labelSize:13, inputSize:14, statusSize:11, fontFamily:"system-ui, sans-serif", labelWeight:"bold",
    shadowOn:true, shadowColor:"#d4a84b", shadowBlur:16, shadowSpread:-4,
    glowOn:true, glowColor:"#d4a84b", glowIntensity:10,
    borderStyle:"double",
    gradientOn:true, gradientEnd:"#1a1408", gradientAngle:180,
    blurOn:false, blurAmount:10,
    bevelOn:false, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:true, iconChar:"\u25c6", iconColor:"#d4a84b", iconSize:16
  },
  "Terminal": {
    width:660, inputHeight:32, padding:8, spacing:4, borderRadius:0, borderWidth:1,
    widgetBg:"#0a0a0a", widgetBorder:"#1a3a1a", inputBg:"#000000", inputText:"#33ff33",
    inputBorder:"#1a3a1a", focusBorder:"#33ff33", labelColor:"#33ff33", statusColor:"#1a6a1a",
    placeholderColor:"#1a4a1a", accent:"#33ff33", errorColor:"#ff3333",
    selBg:"#1a3a1a", selText:"#33ff33",
    labelSize:12, inputSize:13, statusSize:10, fontFamily:"'Courier New', monospace", labelWeight:"bold",
    shadowOn:false, shadowColor:"#000000", shadowBlur:0, shadowSpread:0,
    glowOn:true, glowColor:"#33ff33", glowIntensity:6,
    borderStyle:"solid",
    gradientOn:false, gradientEnd:"#0a1a0a", gradientAngle:180,
    blurOn:false, blurAmount:10,
    bevelOn:false, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:true, iconChar:"\u25b8", iconColor:"#33ff33", iconSize:12
  },
  "Holographic": {
    width:720, inputHeight:42, padding:14, spacing:10, borderRadius:10, borderWidth:2,
    widgetBg:"#0c0c18", widgetBorder:"#8844cc", inputBg:"#0a0a14", inputText:"#e0d8f0",
    inputBorder:"#4422aa", focusBorder:"#cc44ff", labelColor:"#cc66ff", statusColor:"#6644aa",
    placeholderColor:"#3a2a5a", accent:"#cc44ff", errorColor:"#ff4466",
    selBg:"#3a1a6a", selText:"#f0e8ff",
    labelSize:12, inputSize:13, statusSize:11, fontFamily:"'IBM Plex Mono', monospace", labelWeight:"600",
    shadowOn:true, shadowColor:"#8844cc", shadowBlur:24, shadowSpread:-2,
    glowOn:true, glowColor:"#cc44ff", glowIntensity:14,
    borderStyle:"solid",
    gradientOn:true, gradientEnd:"#0a0818", gradientAngle:120,
    blurOn:true, blurAmount:12,
    bevelOn:false, bevelLight:"#3a5252", bevelDark:"#0a1414",
    iconOn:true, iconChar:"\u2726", iconColor:"#cc66ff", iconSize:16
  }
};

let S = {...PRESETS["Current"]};
let activePreset = "Current";

// ═══════════════════════════════════════════════
//  FAKE CODE LINES
// ═══════════════════════════════════════════════
const CODE = [
  {n:1,  c:'<span class="kw">import</span> asyncio'},
  {n:2,  c:'<span class="kw">from</span> pathlib <span class="kw">import</span> Path'},
  {n:3,  c:''},
  {n:4,  c:''},
  {n:5,  c:'<span class="kw">class</span> <span class="fn">DataProcessor</span>:'},
  {n:6,  c:'    <span class="cm"># Main processing pipeline</span>'},
  {n:7,  c:'    <span class="kw">def</span> <span class="fn">__init__</span>(self, config):'},
  {n:8,  c:'        self.config = config'},
  {n:9,  c:'        self.cache = {}', hl:true},
  {n:10, c:'        self.retries = <span class="nr">3</span>', hl:true},
  // — State: Empty —
  {n:11, c:'', hl:true, state:'empty'},
  {n:12, c:''},
  {n:13, c:'    <span class="kw">async def</span> <span class="fn">process</span>(self, data):'},
  {n:14, c:'        <span class="st">"""Process incoming data batch."""</span>'},
  {n:15, c:'        results = []'},
  {n:16, c:'        <span class="kw">for</span> item <span class="kw">in</span> data:', hl:true},
  // — State: Typing —
  {n:17, c:'            result = <span class="kw">await</span> self._transform(item)', hl:true, state:'typing'},
  {n:18, c:''},
  {n:19, c:'            results.append(result)'},
  {n:20, c:'        <span class="kw">return</span> results'},
  {n:21, c:''},
  {n:22, c:'    <span class="kw">async def</span> <span class="fn">_transform</span>(self, item):', hl:true},
  // — State: Generating —
  {n:23, c:'        <span class="kw">try</span>:', hl:true, state:'generating'},
  {n:24, c:''},
  {n:25, c:'            <span class="kw">return await</span> self.client.send(item)'},
  {n:26, c:'        <span class="kw">except</span> ConnectionError:'},
  {n:27, c:'            <span class="kw">return</span> <span class="kw">None</span>'},
  {n:28, c:'', hl:true},
  // — State: Done —
  {n:29, c:'    <span class="kw">def</span> <span class="fn">validate</span>(self, item):', hl:true, state:'done'},
  {n:30, c:''},
  {n:31, c:'        <span class="kw">if not</span> item:'},
  {n:32, c:'            <span class="kw">raise</span> ValueError(<span class="st">"Empty item"</span>)'},
  {n:33, c:'        <span class="kw">return</span> <span class="kw">True</span>'},
  {n:34, c:'', hl:true},
  // — State: Error —
  {n:35, c:'    <span class="kw">def</span> <span class="fn">reset</span>(self):', hl:true, state:'error'},
  {n:36, c:''},
  {n:37, c:'        self.cache.clear()'},
  {n:38, c:'        self.retries = <span class="nr">3</span>'},
];

// Widget states config
const STATES = {
  empty:     {label:"Edit:", placeholder:"Type instruction, Enter to send — Enter/Tab to accept, Esc to undo", value:"", status:"", tag:"EMPTY"},
  typing:    {label:"Edit:", placeholder:"", value:"refactor this to use async/await", status:"", tag:"TYPING"},
  generating:{label:"Edit:", placeholder:"", value:"add error handling with retry logic", status:"Generating...", disabled:true, tag:"GENERATING"},
  done:      {label:"Edit:", placeholder:"", value:"optimize this loop", status:"Done — Enter/Tab to accept, Esc to undo", tag:"DONE"},
  error:     {label:"Edit:", placeholder:"", value:"convert to dataclass", status:"Error: Connection timeout", isError:true, tag:"ERROR"}
};

// ═══════════════════════════════════════════════
//  INIT
// ═══════════════════════════════════════════════
function init() {
  buildPresetButtons();
  bindControls();
  updateAll();
}

function buildPresetButtons() {
  const wrap = document.getElementById('presets');
  wrap.innerHTML = '';
  for (const name of Object.keys(PRESETS)) {
    const btn = document.createElement('button');
    btn.textContent = name;
    btn.onclick = () => loadPreset(name);
    if (name === activePreset) btn.classList.add('active');
    wrap.appendChild(btn);
  }
}

function loadPreset(name) {
  if (!PRESETS[name]) return;
  S = {...PRESETS[name]};
  activePreset = name;
  syncControlsFromState();
  updateAll();
  buildPresetButtons();
}

function bindControls() {
  // Range + color inputs
  document.querySelectorAll('.ctrl input[type=range], .ctrl input[type=color]').forEach(inp => {
    const key = inp.dataset.key;
    if (!key) return;
    inp.addEventListener('input', () => {
      S[key] = inp.type === 'range' ? Number(inp.value) : inp.value;
      activePreset = '';
      buildPresetButtons();
      updateAll();
    });
  });
  // Selects
  document.querySelectorAll('.ctrl select').forEach(sel => {
    const key = sel.dataset.key;
    if (!key) return;
    sel.addEventListener('change', () => {
      S[key] = sel.value;
      activePreset = '';
      buildPresetButtons();
      updateAll();
    });
  });
  // Text inputs
  document.querySelectorAll('.ctrl input[type=text]').forEach(inp => {
    const key = inp.dataset.key;
    if (!key) return;
    inp.addEventListener('input', () => {
      S[key] = inp.value;
      activePreset = '';
      buildPresetButtons();
      updateAll();
    });
  });
  // Toggles
  document.querySelectorAll('.tgl input[type=checkbox]').forEach(cb => {
    const key = cb.dataset.key;
    if (!key) return;
    cb.addEventListener('change', () => {
      S[key] = cb.checked;
      activePreset = '';
      buildPresetButtons();
      updateAll();
    });
  });
  syncControlsFromState();
}

function syncControlsFromState() {
  document.querySelectorAll('.ctrl input[type=range]').forEach(inp => {
    const key = inp.dataset.key;
    if (key && S[key] !== undefined) inp.value = S[key];
  });
  document.querySelectorAll('.ctrl input[type=color]').forEach(inp => {
    const key = inp.dataset.key;
    if (key && S[key] !== undefined) inp.value = S[key];
  });
  document.querySelectorAll('.ctrl select').forEach(sel => {
    const key = sel.dataset.key;
    if (key && S[key] !== undefined) sel.value = S[key];
  });
  document.querySelectorAll('.ctrl input[type=text]').forEach(inp => {
    const key = inp.dataset.key;
    if (key && S[key] !== undefined) inp.value = S[key];
  });
  document.querySelectorAll('.tgl input[type=checkbox]').forEach(cb => {
    const key = cb.dataset.key;
    if (key && S[key] !== undefined) cb.checked = S[key];
  });
}

// ═══════════════════════════════════════════════
//  SECTION TOGGLE
// ═══════════════════════════════════════════════
function toggleSection(head) {
  head.classList.toggle('open');
  const body = head.nextElementSibling;
  body.classList.toggle('open');
}

// ═══════════════════════════════════════════════
//  RENDER
// ═══════════════════════════════════════════════
function updateAll() {
  updateValueDisplays();
  renderPreview();
  renderOutput();
}

function updateValueDisplays() {
  document.querySelectorAll('[data-val]').forEach(el => {
    const key = el.dataset.val || el.getAttribute('data-val');
    const v = S[key];
    if (v === undefined) return;
    if (typeof v === 'string' && v.startsWith('#')) {
      el.textContent = v;
    } else if (typeof v === 'number') {
      el.textContent = v + 'px';
    } else {
      el.textContent = v;
    }
  });
  document.querySelectorAll('[data-tval]').forEach(el => {
    const key = el.dataset.tval;
    el.textContent = S[key] ? 'ON' : 'OFF';
  });
}

function buildWidgetCSS(forState) {
  let bg = S.widgetBg;
  if (S.gradientOn) {
    bg = `linear-gradient(${S.gradientAngle}deg, ${S.widgetBg}, ${S.gradientEnd})`;
  }

  let border;
  if (S.bevelOn) {
    border = `border-top:${S.borderWidth}px solid ${S.bevelLight};border-left:${S.borderWidth}px solid ${S.bevelLight};border-bottom:${S.borderWidth}px solid ${S.bevelDark};border-right:${S.borderWidth}px solid ${S.bevelDark};`;
  } else {
    border = `border:${S.borderWidth}px ${S.borderStyle} ${S.widgetBorder};`;
  }

  let shadow = '';
  if (S.shadowOn) shadow = `box-shadow:0 4px ${S.shadowBlur}px ${S.shadowSpread}px ${S.shadowColor};`;

  let blur = '';
  if (S.blurOn) blur = `backdrop-filter:blur(${S.blurAmount}px);-webkit-backdrop-filter:blur(${S.blurAmount}px);`;

  let inputBorder;
  if (S.bevelOn) {
    inputBorder = `border-top:${Math.max(1,S.borderWidth-1)}px solid ${S.bevelDark};border-left:${Math.max(1,S.borderWidth-1)}px solid ${S.bevelDark};border-bottom:${Math.max(1,S.borderWidth-1)}px solid ${S.bevelLight};border-right:${Math.max(1,S.borderWidth-1)}px solid ${S.bevelLight};`;
  } else {
    inputBorder = `border:1px solid ${S.inputBorder};`;
  }

  return {bg, border, shadow, blur, inputBorder};
}

function renderWidget(stateKey, extraClass='') {
  const st = STATES[stateKey];
  const css = buildWidgetCSS(stateKey);
  const disabled = st.disabled ? 'disabled' : '';
  const genClass = st.disabled ? 'generating' : '';
  const statusColor = st.isError ? S.errorColor : S.statusColor;
  const statusText = st.status;
  const iconHtml = S.iconOn ? `<span class="ie-icon" style="color:${S.iconColor};font-size:${S.iconSize}px">${S.iconChar}</span>` : '';

  // Focus glow for empty state only
  let focusGlow = '';
  if (S.glowOn && stateKey === 'empty') {
    focusGlow = `box-shadow:0 0 ${S.glowIntensity}px ${S.glowColor};border-color:${S.focusBorder};`;
  }

  return `<div class="ie-widget ${genClass} ${extraClass}" style="
    background:${css.bg};
    ${css.border}
    border-radius:${S.borderRadius}px;
    padding:${S.padding}px;
    ${css.shadow}
    ${css.blur}
    --sel-bg:${S.selBg};--sel-fg:${S.selText};
  ">
    <div class="ie-inner" style="gap:${S.spacing}px;display:flex;flex-direction:column">
      <div class="ie-label-row">
        ${iconHtml}
        <span class="ie-label" style="color:${S.labelColor};font-size:${S.labelSize}px;font-weight:${S.labelWeight};font-family:${S.fontFamily}">${st.label}</span>
      </div>
      <input class="ie-input" type="text"
        style="
          height:${S.inputHeight}px;
          background:${S.inputBg};
          color:${S.inputText};
          ${stateKey === 'empty' ? (S.bevelOn ? css.inputBorder : `border:1px solid ${S.focusBorder};`) : css.inputBorder}
          border-radius:${Math.max(0,S.borderRadius-4)}px;
          padding:6px 10px;
          font-size:${S.inputSize}px;
          font-family:${S.fontFamily};
          ${focusGlow}
        "
        placeholder="${st.placeholder}"
        value="${st.value}"
        ${disabled}
        readonly
      >
      ${statusText ? `<span class="ie-status" style="color:${statusColor};font-size:${S.statusSize}px;font-family:${S.fontFamily}">${statusText}</span>` : `<span class="ie-status" style="font-size:${S.statusSize}px;visibility:hidden">&nbsp;</span>`}
    </div>
  </div>`;
}

function renderPreview() {
  const codeArea = document.getElementById('codeArea');
  let html = '<div class="code-lines">';

  for (const line of CODE) {
    const hlClass = line.hl ? ' hl' : '';

    if (line.state) {
      // Insert the widget before this code line
      html += `<div class="state-block">
        <span class="state-tag">${STATES[line.state].tag}</span>
        ${renderWidget(line.state)}
      </div>`;
    }

    html += `<div class="code-line${hlClass}"><span class="ln">${line.n}</span><span class="lc">${line.c || '&nbsp;'}</span></div>`;
  }

  html += '</div>';
  codeArea.innerHTML = html;

  // Apply placeholder color via dynamic style
  const placeholderStyle = document.getElementById('dynamicPlaceholder');
  if (placeholderStyle) placeholderStyle.remove();
  const style = document.createElement('style');
  style.id = 'dynamicPlaceholder';
  style.textContent = `.ie-widget .ie-input::placeholder{color:${S.placeholderColor}!important;opacity:1}.ie-widget .ie-input:disabled{opacity:.7;cursor:default}`;
  document.head.appendChild(style);
}

// ═══════════════════════════════════════════════
//  ANIMATION PREVIEW
// ═══════════════════════════════════════════════
function animShow() {
  renderPreview();
  document.querySelectorAll('.ie-widget').forEach(w => {
    w.classList.remove('anim-show');
    void w.offsetWidth;
    w.classList.add('anim-show');
  });
}
function animGenerating() {
  document.querySelectorAll('.ie-widget').forEach(w => w.classList.add('generating'));
  document.querySelectorAll('.ie-status').forEach(s => {
    if (s.style.visibility !== 'hidden') s.textContent = 'Generating...';
  });
}
function animDone() {
  document.querySelectorAll('.ie-widget').forEach(w => w.classList.remove('generating'));
  document.querySelectorAll('.ie-status').forEach(s => {
    if (s.style.visibility !== 'hidden') s.textContent = 'Done \u2014 Enter/Tab to accept, Esc to undo';
  });
}
function animError() {
  document.querySelectorAll('.ie-widget').forEach(w => w.classList.remove('generating'));
  document.querySelectorAll('.ie-status').forEach(s => {
    if (s.style.visibility !== 'hidden') {
      s.textContent = 'Error: Connection timeout';
      s.style.color = S.errorColor;
    }
  });
}
function animReset() { renderPreview(); }

// ═══════════════════════════════════════════════
//  OUTPUT
// ═══════════════════════════════════════════════
function renderOutput() {
  const el = document.getElementById('outputCode');

  // Build QSS
  let outerBorder, inputBorder, inputFocusBorder;
  if (S.bevelOn) {
    outerBorder = `border-top: ${S.borderWidth}px solid ${S.bevelLight};\\n`
      + `                border-left: ${S.borderWidth}px solid ${S.bevelLight};\\n`
      + `                border-bottom: ${S.borderWidth}px solid ${S.bevelDark};\\n`
      + `                border-right: ${S.borderWidth}px solid ${S.bevelDark};`;
    inputBorder = `border-top: ${Math.max(1,S.borderWidth-1)}px solid ${S.bevelDark};\\n`
      + `                border-left: ${Math.max(1,S.borderWidth-1)}px solid ${S.bevelDark};\\n`
      + `                border-bottom: ${Math.max(1,S.borderWidth-1)}px solid ${S.bevelLight};\\n`
      + `                border-right: ${Math.max(1,S.borderWidth-1)}px solid ${S.bevelLight};`;
    inputFocusBorder = inputBorder;
  } else {
    outerBorder = `border: ${S.borderWidth}px ${S.borderStyle} ${S.widgetBorder};`;
    inputBorder = `border: 1px solid ${S.inputBorder};`;
    inputFocusBorder = `border: 2px solid ${S.focusBorder};`;
  }

  let bgLine = `background-color: ${S.widgetBg};`;

  let extras = [];
  if (S.shadowOn) extras.push(`/* box-shadow not supported in QSS — apply via QGraphicsDropShadowEffect */`);
  if (S.blurOn) extras.push(`/* backdrop-filter not supported in QSS — use translucent QWidget bg */`);

  const qss = `<span class="py-cm"># Generated by InlineEditBar Playground</span>
<span class="py-cm"># Paste into InlineEditBar._apply_style()</span>

self.setStyleSheet(<span class="py-str">f"""
    QWidget {{
        ${bgLine}
        color: ${S.inputText};
        font-size: ${S.inputSize}px;
        ${outerBorder}
        border-radius: ${S.borderRadius}px;
    }}
    QLabel {{
        background-color: transparent;
        color: ${S.labelColor};
        border: none;
        font-weight: ${S.labelWeight};
        font-size: ${S.labelSize}px;
    }}
    QLineEdit {{
        background-color: ${S.inputBg};
        color: ${S.inputText};
        ${inputBorder}
        border-radius: ${Math.max(0, S.borderRadius - 4)}px;
        padding: 6px 10px;
        font-size: ${S.inputSize}px;
        selection-background-color: ${S.selBg};
        selection-color: ${S.selText};
    }}
    QLineEdit:focus {{
        ${inputFocusBorder}
    }}
"""</span>)${extras.length ? '\n\n' + extras.join('\n') : ''}${S.iconOn ? `\n\n<span class="py-cm"># Icon: "${S.iconChar}" at ${S.iconSize}px in ${S.iconColor}</span>\n<span class="py-cm"># Add QLabel with icon char before the "Edit:" label</span>` : ''}`;

  el.innerHTML = qss;
}

function copyQSS(btn) {
  const el = document.getElementById('outputCode');
  const text = el.textContent || el.innerText;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'Copied!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'Copy QSS';
      btn.classList.remove('copied');
    }, 1500);
  });
}

// ═══════════════════════════════════════════════
//  GO
// ═══════════════════════════════════════════════
init();
</script>
</body>
</html>